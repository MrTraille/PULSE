{% extends "base.html" %}
{% block title %}Projets - AngryTode{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <!-- <h1 class="h4 mb-1">Mes projets</h1>
      <p class="text-muted small mb-0">
        Planning de sorties, deadlines et checklists centralisées.
      </p> -->
    </div>
  </div>

  <!-- Formulaire de création -->
<form method="post" action="{{ url_for('new_project') }}" class="new-project-form card border-secondary mb-4">
  <div class="card-body">
    <h2 class="h6 mb-3 form-title">Nouveau projet</h2>

    <div class="mb-3">
      <label for="title" class="form-label form-title">Titre</label>
      <input id="title" name="title" type="text" class="form-control" placeholder="Nom du morceau" required>
    </div>

    <div class="mb-3">
      <label for="artist" class="form-label form-title">Artiste</label>
      <input id="artist" name="artist" type="text" class="form-control" placeholder="Nom de l'artiste" required>
    </div>

    <div class="mb-3">
      <label for="label" class="form-label form-title">Label</label>
      <input id="label" name="label" type="text" class="form-control" placeholder="Nom du label">
    </div>

    <div class="mb-3">
      <label class="form-label form-title">Type de projet</label>

      <div class="dropdown custom-release-dropdown" data-bs-display="static">
        <button
          class="btn dropdown-toggle custom-release-toggle"
          type="button"
          data-bs-toggle="dropdown"
          aria-expanded="false">
          <span class="custom-release-label">--- Choisir ---</span>
        </button>

        <ul class="dropdown-menu custom-release-menu">
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Single">Single</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="EP">EP</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Album">Album</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Autre">Autre</button></li>
        </ul>

        <!-- vraie valeur envoyée au serveur -->
        <input type="hidden" class="custom-release-input" name="release_type" value="">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label form-title">Style / Genre</label>

      <div class="dropdown custom-release-dropdown" data-bs-display="static">
        <button
          class="btn dropdown-toggle custom-release-toggle"
          type="button"
          data-bs-toggle="dropdown"
          aria-expanded="false">
          <span class="custom-release-label">--- Choisir ---</span>
        </button>

        <ul class="dropdown-menu custom-release-menu">
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Synthwave">Synthwave</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Lofi">Lofi</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Metal">Metal</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Chiptune">Chiptune</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Symphonique">Symphonique</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Cinématique">Cinématique</button></li>
          <li><button class="dropdown-item custom-release-option" type="button" data-value="Autre">Autre</button></li>
        </ul>

        <!-- importante : ici le name doit être "style" -->
        <input type="hidden" class="custom-release-input" name="style" value="">
      </div>
    </div>

    <div class="mb-3">
      <label for="release_date" class="form-label form-title">Date de sortie</label>
      <input id="release_date" name="release_date" type="date" class="form-control date-input" required>
    </div>
  <div class="mt-3">
    <div class="form-check">
      <input
        class="form-check-input"
        type="checkbox"
        id="use_spotify_canvas"
        name="use_spotify_canvas"
      >
      <label class="form-check-label small form-title" for="use_spotify_canvas">
        Prévoir un Canvas Spotify
      </label>
    </div>

    <div class="form-check">
      <input
        class="form-check-input"
        type="checkbox"
        id="use_paid_ads"
        name="use_paid_ads"
      >
      <label class="form-check-label small form-title" for="use_paid_ads">
        Prévoir une campagne de pub payante (Meta / Instagram / TikTok)
      </label>
    </div>
  </div>

    <div class="d-flex justify-content-end">
      <button type="submit" class="btn btn-sm btn-outline-light form-title">Créer</button>
    </div>
  </div>
</form>


  <!-- Liste des projets -->
  {% if projects %}
    <div class="project-list">
      {% for p in projects %}
        <article class="project-card">
          <div class="project-main">
            <div class="project-title-row">
              <h2 class="h6 mb-0">{{ p.title }}</h2>
              {% set badge_class = "bg-dark" %}
              {% if p.status == "Programmé" %}
                {% set badge_class = "bg-dark" %}
              {% elif p.status == "En cours" %}
                {% set badge_class = "bg-info" %}
              {% elif p.status == "Sortie" %}
                {% set badge_class = "bg-success" %}
              {% endif %}
            <span class="pill-badge
              {{ 'status-programme' if p.status=='Programmé'
                else ('status-en-cours' if p.status=='En cours' else 'status-sortie') }}">
              {{ p.status }}
            </span>
            </div>

            <!-- Ligne 1 : Artiste • style • label -->
            <div class="project-meta">
              <span class="project-artist">{{ p.artist }}</span>
              {% if p.genre %}
                • <span class="project-genre">{{ p.genre }}</span>
              {% endif %}
              • <span class="project-label-inline">{{ p.label }}</span>
            </div>

            <!-- Ligne 2 : Date de sortie -->
            <div class="project-date-line small text-muted">
              Date de sortie : {{ p.release_date }}
            </div>
          </div>



          <div class="project-actions">
            {% if not p.is_released %}
              <a href="{{ url_for('project_detail', slug=p.slug) }}" class="btn btn-sm btn-outline-light">
                Voir le projet
              </a>
            {% else %}
              <a href="{{ url_for('project_detail', slug=p.slug) }}" class="btn btn-sm btn-outline-secondary">
                Historique
              </a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">
      Aucun projet pour l'instant.
    </p>
  {% endif %}
  {% block scripts %}
  <script>
  document.addEventListener("DOMContentLoaded", function () {
  // Dropdowns custom
  document.querySelectorAll(".custom-release-dropdown").forEach(function (dropdown) {
    const hiddenInput = dropdown.querySelector(".custom-release-input");
    const labelSpan   = dropdown.querySelector(".custom-release-label");
    const toggleBtn   = dropdown.querySelector(".custom-release-toggle");

    dropdown.querySelectorAll(".custom-release-option").forEach(function (opt) {
      opt.addEventListener("click", function () {
        const value = this.dataset.value;

        if (hiddenInput) hiddenInput.value = value;
        if (labelSpan)   labelSpan.textContent = value;
        if (toggleBtn)   toggleBtn.classList.add("custom-release-selected");
      });
    });
  });

  // Couleur de la date
  const dateInput = document.getElementById("release_date");
  if (dateInput) {
    function updateDateColor() {
      if (dateInput.value) {
        dateInput.classList.add("has-value");
      } else {
        dateInput.classList.remove("has-value");
      }
    }

    updateDateColor();
    dateInput.addEventListener("change", updateDateColor);
  }
});
  </script>
  {% endblock %}
{% endblock %}

